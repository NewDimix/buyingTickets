const ticketReservationApp={elements:{route:document.getElementById("route"),timeA:document.getElementById("timeA"),timeB:document.getElementById("timeB"),num:document.getElementById("num"),resultBtn:document.getElementById("result"),info:document.getElementById("info")},prices:{"A-B":700,"B-A":700,"A-B-A":1200},travelTime:50,timeZone:"+03:00"},order={route:"A-B",amount:1,startPosition:[],departureTimes:[],date:{year:"2022",month:"August",date:"21"}};function getTimeText(e){if(0===e)return 0;let t="";return 60<e&&(t+=Math.floor(e/60)+" ч. "),0<e%60&&(t+=e%60+" мин."),t}function formReset(e){if(3<=e&&(ticketReservationApp.elements.timeA.setAttribute("disabled","true"),ticketReservationApp.elements.timeA.value=null,order.startPosition.length=0),2<=e){ticketReservationApp.elements.timeB.setAttribute("disabled","true"),ticketReservationApp.elements.timeB.value=null,order.departureTimes.length=0;var t=ticketReservationApp.elements.timeB.getElementsByTagName("option");for(let e=1;e<t.length;e++)t[e].removeAttribute("style")}1<=e&&(ticketReservationApp.elements.num.setAttribute("disabled","true"),ticketReservationApp.elements.num.value=1,order.amount=1,ticketReservationApp.elements.resultBtn.setAttribute("disabled","true"),1<order.departureTimes.length&&order.departureTimes.pop()),0<=e&&(ticketReservationApp.elements.info.textContent="")}function getNewDate(e,t){return new Date(order.date.month+" "+order.date.date+", "+order.date.year+" "+e+" "+t)}function convertTime(){var t=ticketReservationApp.elements.timeA.getElementsByTagName("option");for(let e=1;e<t.length;e++){var r=("0"+getNewDate(t[e].value,ticketReservationApp.timeZone).getHours()).slice(-2)+":"+("0"+getNewDate(t[e].value,ticketReservationApp.timeZone).getMinutes()).slice(-2);t[e].textContent=r}var i=ticketReservationApp.elements.timeB.getElementsByTagName("option");for(let e=1;e<i.length;e++){var n=("0"+getNewDate(i[e].value,ticketReservationApp.timeZone).getHours()).slice(-2)+":"+("0"+getNewDate(i[e].value,ticketReservationApp.timeZone).getMinutes()).slice(-2);i[e].textContent=n}}function getInterval(e,t){var t=Math.round((t-e)/1e3),e=Math.round(t/60),r=Math.round(e/60);return{days:Math.round(r/24),hours:r,minutes:e,seconds:t}}ticketReservationApp.elements.route.addEventListener("input",function(){formReset(3),order.route=ticketReservationApp.elements.route.value,"A-B"===order.route?order.startPosition.push(["A","B"]):"B-A"===order.route?order.startPosition.push(["B","A"]):"A-B-A"===order.route&&order.startPosition.push(["A","B"],["B","A"]),"A"===order.startPosition[0][0]?ticketReservationApp.elements.timeA.removeAttribute("disabled"):"B"===order.startPosition[0][0]&&ticketReservationApp.elements.timeB.removeAttribute("disabled")}),ticketReservationApp.elements.timeA.addEventListener("input",function(){if(formReset(2),order.departureTimes.push(getNewDate(ticketReservationApp.elements.timeA.value,ticketReservationApp.timeZone)),1<order.startPosition.length){ticketReservationApp.elements.timeB.removeAttribute("disabled");var t=ticketReservationApp.elements.timeB.getElementsByTagName("option"),r=new Date(order.departureTimes[0].getTime());r.setMinutes(r.getMinutes()+ticketReservationApp.travelTime);for(let e=1;e<t.length;e++)r>getNewDate(t[e].value,ticketReservationApp.timeZone)&&(t[e].style.display="none")}else ticketReservationApp.elements.num.removeAttribute("disabled"),ticketReservationApp.elements.resultBtn.removeAttribute("disabled")}),ticketReservationApp.elements.timeB.addEventListener("input",function(){formReset(1),order.departureTimes.push(getNewDate(ticketReservationApp.elements.timeB.value,ticketReservationApp.timeZone)),ticketReservationApp.elements.num.removeAttribute("disabled"),ticketReservationApp.elements.resultBtn.removeAttribute("disabled")}),ticketReservationApp.elements.num.addEventListener("input",function(){formReset(0),ticketReservationApp.elements.num.value<1?ticketReservationApp.elements.resultBtn.setAttribute("disabled","true"):ticketReservationApp.elements.resultBtn.removeAttribute("disabled"),order.amount=ticketReservationApp.elements.num.value}),ticketReservationApp.elements.resultBtn.onclick=function(){event.preventDefault();var e=order.amount*ticketReservationApp.prices[order.route];let t="";for(let e=0;e<order.startPosition.length;e++)0===e?t+=order.startPosition[e][0]+" - "+order.startPosition[e][1]:t+=" - "+order.startPosition[e][1];var e="<p>Выбрано билетов: "+order.amount+". Ваш маршрут: "+t+". Общая стоимость: "+e+" р.</p>",r=order.startPosition.length*ticketReservationApp.travelTime,i="<p>Время, которое Вы проведете на теплоходе: "+getTimeText(r)+"</p>";let n="",o,s=(1<order.startPosition.length&&(o=getInterval(order.departureTimes[0],order.departureTimes[1]).minutes+ticketReservationApp.travelTime,n="<p>Сумарное время вашего путешествия: "+getTimeText(o)+"</p>"),""),a=(1<order.startPosition.length&&(r=o-r,s="<p>Время на прогулку: "+getTimeText(r)+"</p>"),""),m;if(1<order.startPosition.length)for(let e=0;e<order.startPosition.length;e++)(m=new Date(order.departureTimes[e].getTime())).setMinutes(m.getMinutes()+ticketReservationApp.travelTime),a+="<p>Теплоход отправляется из "+order.startPosition[e][0]+" в "+("0"+order.departureTimes[e].getHours()).slice(-2)+":"+("0"+order.departureTimes[e].getMinutes()).slice(-2)+" и прибывает в "+order.startPosition[e][1]+" в "+("0"+m.getHours()).slice(-2)+":"+("0"+m.getMinutes()).slice(-2)+".</p>";else(m=new Date(order.departureTimes[0].getTime())).setMinutes(m.getMinutes()+ticketReservationApp.travelTime),a="<p>Теплоход отправляется из "+order.startPosition[0][0]+" в "+("0"+order.departureTimes[0].getHours()).slice(-2)+":"+("0"+order.departureTimes[0].getMinutes()).slice(-2)+" и прибывает в "+order.startPosition[0][1]+" в "+("0"+m.getHours()).slice(-2)+":"+("0"+m.getMinutes()).slice(-2)+".</p>";ticketReservationApp.elements.info.innerHTML=e+i+n+s+a},convertTime();